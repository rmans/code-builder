---
id: TASK-2025-09-07-T4.3-cursor-hooks
title: Cursor Integration Hooks
description: Use/extend builder/utils/cursor_agent_integration.py to update current.md and per-task rules
status: completed
created: 2025-09-07
updated: 2025-09-07
owner: backend-agent
domain: cursor
priority: 8
agent_type: backend
dependencies: [T0.5, T3.4]
tags: [cursor, hooks, current-md]
---

# Task: Cursor Integration Hooks

## Phases
### Phase 1: ðŸš€ Implementation
- [x] `on_task_create()` â†’ regenerate per-task rules
- [x] `on_agent_start()` â†’ update `.cb/instructions/current.md`

### Phase 2: ðŸ§ª Testing
- [x] Hooks fire during orchestrations; file content correct

### Phase 3: ðŸ“š Documentation
- [x] Describe hook timing and side effects

### Phase 4: ðŸ§¹ Cleanup
- [x] Avoid tight loops; debounce updates

### Phase 5: ðŸ’¾ Commit
- [x] Commit

## Acceptance Criteria
- [x] current.md always reflects active task/agent

## Completion Summary

**Status**: âœ… COMPLETED

**Implementation Details**:
- âœ… Implemented `on_task_create()` hook that regenerates per-task rules using `command_generator.generate_task_commands()`
- âœ… Implemented `on_agent_start()` hook that updates `.cb/instructions/current.md` with active task/agent information
- âœ… Added debouncing mechanism to prevent rapid updates (configurable via `set_update_debounce()`)
- âœ… Integrated hooks into `add_task()` and `launch_cursor_agent_for_task()` methods
- âœ… Added fallback logic to handle agents from base orchestrator when not found in `cursor_agents` dictionary

**Generated Files**:
- âœ… Enhanced `builder/utils/cursor_agent_integration.py` with hook system
- âœ… `.cb/instructions/current.md` automatically created and updated

**Testing Results**:
- âœ… `on_task_create` hook successfully regenerates per-task rules for all 37 tasks
- âœ… `on_agent_start` hook successfully creates and updates `current.md` with task/agent details
- âœ… Debouncing prevents excessive file updates
- âœ… Hooks work with both newly added agents and existing agents from orchestrator state

**Key Features**:
- **Per-Task Rule Regeneration**: Automatically generates command files for new tasks
- **Current Task Tracking**: Real-time updates to `.cb/instructions/current.md` showing active task and agent
- **Debouncing**: Prevents rapid file updates with configurable debounce interval
- **Agent Compatibility**: Works with both cursor agents and base orchestrator agents
- **Error Handling**: Graceful fallback when agents or tasks are not found

**Integration Points**:
- Integrated with `TaskOrchestrator` for task management
- Integrated with `MultiAgentCursorManager` for agent launching
- Integrated with `command_generator` for rule regeneration
- Uses `.cb/instructions/` directory for current task tracking
